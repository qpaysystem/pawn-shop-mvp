# Пошаговая инструкция: запуск на боевом хостинге

Инструкция для выкладки проекта **pawn-shop-mvp** на боевой сервер (на примере Timeweb по SSH). Все шаги выполняются по порядку.

---

## Что понадобится заранее

- Доступ по **SSH** к хостингу (логин, пароль или ключ, адрес сервера — смотрите в панели хостинга).
- **Домен** или временный адрес сайта (например `ваш-сайт.timeweb.ru`).
- В панели хостинга нужно будет **создать базу MySQL** и записать: имя БД, пользователь, пароль, хост (часто `localhost`).

---

## Часть 1. Подготовка на вашем компьютере

### Шаг 1. Собрать файлы проекта

Убедитесь, что у вас есть папка проекта **pawn-shop-mvp** со всеми файлами (app, config, public, routes, storage, composer.json и т.д.). Файл `.env` на сервер не заливаем — он создаётся на хостинге.

**Если используете Git:** репозиторий должен быть запушен, на хостинге будете клонировать по SSH.

**Если без Git:** подготовьте архив проекта (без папки `.git` и без `.env`):

```bash
# В каталоге, где лежит папка pawn-shop-mvp:
tar --exclude='.git' --exclude='.env' -czf pawn-shop-mvp.tar.gz pawn-shop-mvp
```

Архив `pawn-shop-mvp.tar.gz` понадобится для загрузки на сервер.

---

## Часть 2. Действия в панели хостинга (до SSH)

### Шаг 2. Создать базу данных MySQL

1. Войдите в панель управления хостингом (Timeweb: hosting.timeweb.ru).
2. Откройте раздел **«Базы данных»** (или «MySQL»).
3. Создайте новую базу данных.
4. Создайте пользователя БД с полными правами на эту базу (или используйте предложенного пользователя).
5. Запишите и сохраните у себя:
   - **Имя базы** (например `u1234567_lombard`)
   - **Пользователь БД**
   - **Пароль БД**
   - **Сервер БД** (часто `localhost` или указан в панели)

Позже эти данные будут прописаны в файле `.env` на сервере.

### Шаг 3. Узнать данные для SSH

В панели найдите раздел **«SSH»** или **«Доступ по SSH»**. Запишите:

- **Хост** (например `ваш-логин.timeweb.ru` или IP)
- **Логин** (например `u1234567`)
- **Пароль** или способ входа по ключу

Подключение будет таким: `ssh логин@хост`.

---

## Часть 3. Подключение к серверу и загрузка файлов

### Шаг 4. Подключиться к серверу по SSH

На вашем компьютере откройте терминал и выполните (подставьте свой логин и хост):

```bash
ssh u1234567@ваш-сервер.timeweb.ru
```

Введите пароль, если спросит. Вы окажетесь в домашнем каталоге на сервере (например `/home/u1234567`).

### Шаг 5. Создать каталог для сайта

На сервере (после подключения по SSH):

```bash
cd ~
mkdir -p pawn-shop-mvp
```

Каталог `pawn-shop-mvp` будет корнем проекта.

### Шаг 6. Загрузить файлы проекта на сервер

**Способ А — через Git (если на хостинге есть Git):**

На сервере:

```bash
cd ~/pawn-shop-mvp
git clone https://ваш-репозиторий.git .
```

Точка в конце команды важна — клонирование идёт в текущую папку.

**Способ Б — через SCP с вашего компьютера (второй терминал, не закрывая SSH):**

На **вашем компьютере** (в каталоге, где лежит архив или папка проекта):

```bash
# Если загружаете архив:
scp pawn-shop-mvp.tar.gz u1234567@ваш-сервер.timeweb.ru:~/
```

Затем снова на **сервере**:

```bash
cd ~
tar xzf pawn-shop-mvp.tar.gz
# Если в архиве была папка pawn-shop-mvp, то файлы уже в ~/pawn-shop-mvp
# Если распаковалось иначе — переместите файлы в ~/pawn-shop-mvp так, чтобы внутри были папки app, config, public, routes и т.д.
ls -la pawn-shop-mvp
```

Должны быть видны папки: `app`, `config`, `database`, `public`, `resources`, `routes`, `storage`, файлы `artisan`, `composer.json`.

---

## Часть 4. Настройка Laravel на сервере (по шагам)

Все следующие команды выполняются **на сервере** по SSH, из корня проекта.

### Шаг 7. Сделать симлинк public_html → public (обязательно для Timeweb)

На сервере:

```bash
cd ~
rm -rf pawn-shop-mvp/public_html
ln -s ~/pawn-shop-mvp/public ~/pawn-shop-mvp/public_html
```

Так хостинг будет отдавать в браузере содержимое папки `public` Laravel.

### Шаг 8. Установить Composer и зависимости PHP

```bash
cd ~/pawn-shop-mvp
curl -sS https://getcomposer.org/installer | php
php composer.phar install --no-dev --optimize-autoloader
```

Дождитесь окончания. Должна появиться папка `vendor`.

### Шаг 9. Создать файл .env

```bash
cp .env.example .env
php artisan key:generate
```

Ключ приложения будет записан в `.env` автоматически.

### Шаг 10. Заполнить .env для боевого режима

Откройте файл для редактирования:

```bash
nano .env
```

Измените или проверьте следующие строки (подставьте свои данные):

```env
APP_NAME="Ломбард MVP"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://ваш-домен.ru

DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=имя_вашей_базы
DB_USERNAME=пользователь_базы
DB_PASSWORD=пароль_базы
```

- `APP_URL` — точный адрес сайта (с https:// или http://), без слэша в конце.
- `DB_*` — те данные, что вы записали в шаге 2.

Сохранить в nano: **Ctrl+O**, Enter, затем выход: **Ctrl+X**.

### Шаг 11. Запустить миграции и сидер

```bash
php artisan migrate --force
php artisan db:seed --force
```

Таблицы в БД созданы, добавлены тестовые пользователи и справочники.

### Шаг 12. Создать симлинк storage и папку для фото

```bash
php artisan storage:link
mkdir -p storage/app/public/items
```

### Шаг 13. Включить кэш (для production)

```bash
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

### Шаг 14. Права на запись (если появятся ошибки 500 при работе сайта)

```bash
chmod -R 775 storage bootstrap/cache
```

---

## Часть 5. Привязка домена в панели хостинга

### Шаг 15. Создать или привязать сайт к каталогу проекта

1. В панели хостинга откройте **«Сайты»** → **«Мои сайты»** (или аналог).
2. Создайте новый сайт или привяжите домен к существующему.
3. В качестве **корневой директории сайта** укажите каталог, где лежит проект, например:
   - `pawn-shop-mvp`  
   или полный путь вроде `/home/u1234567/pawn-shop-mvp`.

Хостинг будет искать в этой директории папку `public_html` и отдавать её содержимое. Мы сделали симлинк `public_html` → `public`, поэтому отдаётся папка Laravel `public` — это правильно.

4. Сохраните настройки. Домен должен начать открываться (может потребоваться 1–2 минуты или перезапуск сервиса).

---

## Часть 6. Проверка

### Шаг 16. Открыть сайт в браузере

Откройте в браузере адрес вашего сайта (тот же, что в `APP_URL`).

- Должна открыться страница входа в систему.
- **Логин:** `admin@example.com`
- **Пароль:** `password`

(Эти данные создаются сидером на шаге 11. После первого входа рекомендуется сменить пароль.)

Если видите ошибку 500 — проверьте права (шаг 14) и логи: на сервере `cat storage/logs/laravel.log` (последние строки).

---

## Краткая шпаргалка: только команды на сервере (после загрузки файлов)

Если вы уже загрузили файлы в `~/pawn-shop-mvp` и создали БД, можно выполнить подряд:

```bash
cd ~
rm -rf pawn-shop-mvp/public_html
ln -s ~/pawn-shop-mvp/public ~/pawn-shop-mvp/public_html

cd ~/pawn-shop-mvp
curl -sS https://getcomposer.org/installer | php
php composer.phar install --no-dev --optimize-autoloader
cp .env.example .env
php artisan key:generate
nano .env   # заполнить APP_URL, DB_* и сохранить
php artisan migrate --force
php artisan db:seed --force
php artisan storage:link
mkdir -p storage/app/public/items
php artisan config:cache
php artisan route:cache
php artisan view:cache
chmod -R 775 storage bootstrap/cache
```

После этого в панели привязать домен к каталогу `pawn-shop-mvp` и проверить сайт.

---

## Обновление сайта после изменений в коде

Когда вы внесли изменения в проект и снова загрузили файлы на сервер (через Git или SCP):

```bash
cd ~/pawn-shop-mvp
# Если используете Git:
git pull

php composer.phar install --no-dev --optimize-autoloader
php artisan migrate --force
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

Или запустите скрипт обновления (если есть): `./deploy.sh`

---

## Другой хостинг (не Timeweb)

Если хостинг другой, но есть SSH:

- Вместо симлинка `public_html` настройте в панели **Document Root** на папку `public` проекта (например `.../pawn-shop-mvp/public`).
- Остальные шаги (Composer, .env, миграции, storage:link, кэш) — те же.

Если хостинг без SSH (только FTP и панель): создайте БД, залейте файлы так, чтобы корень сайта указывал на папку `public`, загрузите готовый `.env` (сгенерируйте `APP_KEY` локально: `php artisan key:generate --show`). Запуск миграций возможен через «Выполнить PHP» в панели или по инструкции вашего хостинга.

---

## Опционально: переменные .env для дополнительных функций

Для лендинга, API распознавания, интеграций можно позже добавить в `.env`:

- `LOMBARD_NAME`, `LOMBARD_PHONE` — название и телефон в шапке/футере.
- `GEMINI_API_KEY` или `GOOGLE_VISION_API_KEY` — распознавание текста с фото.
- `OPENAI_API_KEY`, `DEEPSEEK_API_KEY` — паспорт, транскрипция.
- `SERPER_API_KEY` — поиск объявлений.
- И другие по необходимости (см. `.env.example`).

Без них приложение работает; дополнительные функции просто будут недоступны.
